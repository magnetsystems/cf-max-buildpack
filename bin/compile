#!/bin/bash
#
# Install java (for now we assume it has been installed), unzip
# the single zip file and configure the deployment variables.
#
# Usage: compile build-dir cacha-dir

#install_java

echo "=== Switching to directory: $1"
cd $1

if [[ -z "$JAVA_HOME" ]]; then
  export JAVA_HOME=/home/vcap/app/.java-buildpack/open_jdk_jre
  export PATH=$JAVA_HOME/bin:$PATH
fi

ls -aR
ls -la /home/vcap/app
ls -la /iome/vcap/app
ls -l $JAVA_HOME

echo "=== JAVA_HOME=$JAVA_HOME"
echo "=== PATH=$PATH"
echo "=== java in `which java`"

# buildpack automatically appends .zip suffix
echo "=== Unzip max-server.zip"
unzip max-server

# This step will not be needed if the customization is done before the cf push.
# It requires java, so it may be problematic if java runtime is not available.
echo "=== Set deployment environment"
max-server/bin/replace-env.sh max-server/server/conf/default deploy_env/default.props deploy_env/cf.props
